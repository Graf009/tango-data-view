function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}import{Component}from'@eagle/tango';import{fromJS,Iterable,List,Map}from'immutable';var DataComponent=function(_Component){_inherits(DataComponent,_Component);function DataComponent(){_classCallCheck(this,DataComponent);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}var _this=_possibleConstructorReturn(this,_Component.call.apply(_Component,[this].concat(args)));if(!_this.constructor.storeProps){throw new Error('DataComponent requires storeProps to be defined! Did you forget to use the connect decorator?');}return _this;}DataComponent.prototype.componentWillMount=function componentWillMount(){this.tryResolveData();};DataComponent.prototype.componentDidUpdate=function componentDidUpdate(){if(!this.handleResolved)return;if(this._resolved)return;var loading=this.getResolvingFields();if(loading.size!==0)return;this._resolved=true;this.handleResolved(this.getResolvedData());};DataComponent.prototype.getResolvingFields=function getResolvingFields(){var _this2=this;return fromJS(this.constructor.storeProps).reduce(function(prev,cursor,prop){return _this2.isPropResolving(prop)?prev.push(prop):prev;},List());};DataComponent.prototype.getErrors=function getErrors(){var _this3=this;return fromJS(this.constructor.storeProps).reduce(function(prev,cursor,prop){return _this3.isPropErrored(prop)?prev.set(prop,_this3.props[prop].get('error')):prev;},Map());};DataComponent.prototype.getResolvedData=function getResolvedData(){var _this4=this;return Object.keys(this.constructor.storeProps).reduce(function(prev,prop){var val=_this4.props[prop];if(!_this4.isPropResolving(prop)){prev[prop]=Iterable.isIterable(val)?val.get('data')||val:val;}return prev;},{});};DataComponent.prototype.tryResolveData=function tryResolveData(){if(!this.resolveData)return;var loading=this.getResolvingFields();if(loading.size===0)return;this.resolveData();};DataComponent.prototype.isPropResolving=function isPropResolving(prop){return this.props[prop]==null||Iterable.isIterable(this.props[prop])&&this.props[prop].get('pending')===true;};DataComponent.prototype.isPropErrored=function isPropErrored(prop){return Iterable.isIterable(this.props[prop])&&this.props[prop].get('error')!=null;};DataComponent.prototype.isResolving=function isResolving(){return!this.isErrored()&&!this.getResolvingFields().isEmpty();};DataComponent.prototype.isErrored=function isErrored(){return!this.getErrors().isEmpty();};DataComponent.prototype.renderLoader=function renderLoader(){return null;};DataComponent.prototype.renderErrors=function renderErrors(){return null;};DataComponent.prototype.renderData=function renderData(){return null;};DataComponent.prototype.render=function render(){var node=null;if(this.isResolving()){node=this.renderLoader(this.getResolvingFields());}else if(this.isErrored()){node=this.renderErrors(this.getErrors());}else{node=this.renderData(this.getResolvedData());}return node;};return DataComponent;}(Component);export default DataComponent;